<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Soia</title>
    <meta name="description" content="Complete documentation for the Soia language - language reference, code generators, and examples.">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/docs.css">
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="../" class="nav-brand">
                    <img src="../assets/logo.svg" alt="Soia Logo" class="logo" width="32" height="32">
                    <span class="brand-text">Soia</span>
                </a>
            </div>
            <div class="nav-links">
                <a href="../#features">Features</a>
                <a href="#" class="active">Documentation</a>
                <a href="../playground/">Playground</a>
                <a href="https://github.com/gepheum/soia" target="_blank">GitHub</a>
            </div>
        </div>
    </nav>

    <div class="docs-layout">
        <!-- Sidebar Navigation -->
        <aside class="docs-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <h3>Getting Started</h3>
                    <ul>
                        <li><a href="#introduction">Introduction</a></li>
                        <li><a href="#installation">Installation</a></li>
                        <li><a href="#quick-start">Quick Start</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <h3>Language Reference</h3>
                    <ul>
                        <li><a href="#records">Records</a></li>
                        <li><a href="#data-types">Data Types</a></li>
                        <li><a href="#constants">Constants</a></li>
                        <li><a href="#methods">Methods</a></li>
                        <li><a href="#imports">Imports</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <h3>Serialization</h3>
                    <ul>
                        <li><a href="#json-dense">JSON (Dense)</a></li>
                        <li><a href="#json-readable">JSON (Readable)</a></li>
                        <li><a href="#binary-format">Binary Format</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <h3>Code Generators</h3>
                    <ul>
                        <li><a href="#typescript-generator">TypeScript</a></li>
                        <li><a href="#python-generator">Python</a></li>
                        <li><a href="#cpp-generator">C++</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <h3>Services</h3>
                    <ul>
                        <li><a href="#soia-services">Soia Services</a></li>
                        <li><a href="#service-examples">Examples</a></li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="docs-main">
            <div class="docs-content">
                <div class="page-header">
                    <h1>Soia Documentation</h1>
                    <p class="page-subtitle">Complete guide to the Soia language and its code generators</p>
                </div>

                <!-- Introduction -->
                <section id="introduction" class="docs-section">
                    <h2>Introduction</h2>
                    <p>Soia is a language for representing data types, constants and RPC interfaces. It's designed as a modern alternative to Protocol Buffers with enhanced type safety and multi-language support.</p>
                    
                    <div class="feature-grid">
                        <div class="feature-item">
                            <h4>üåê Multi-Language</h4>
                            <p>Generate code for JavaScript/TypeScript, Python, C++, and more.</p>
                        </div>
                        <div class="feature-item">
                            <h4>üîí Type Safe</h4>
                            <p>Generated code makes no compromises with type safety.</p>
                        </div>
                        <div class="feature-item">
                            <h4>üîÑ Future-Proof</h4>
                            <p>Built-in backward and forward compatibility.</p>
                        </div>
                        <div class="feature-item">
                            <h4>üì¶ Multiple Formats</h4>
                            <p>Serialize to JSON or compact binary format.</p>
                        </div>
                    </div>

                    <div class="code-example">
                        <div class="code-header">Example Soia File</div>
                        <pre><code class="language-soia">// shapes.soia
struct Point {
  x: int32;
  y: int32;
  label: string;
}

struct Polyline {
  points: [Point];
  label: string;
}

const TOP_RIGHT_CORNER: Point = {
  x = 600,
  y = 400,
  label = "top-right corner",
};

// Method of an RPC interface
method IsPalindrome(string): bool;</code></pre>
                    </div>
                </section>

                <!-- Installation -->
                <section id="installation" class="docs-section">
                    <h2>Installation</h2>
                    <p>Install the Soia compiler globally using npm:</p>
                    
                    <div class="code-example">
                        <div class="code-header">Terminal</div>
                        <pre><code class="language-bash">npm install -g soiac</code></pre>
                    </div>

                    <p>Create a <code>soia.yml</code> configuration file in your project root:</p>

                    <div class="code-example">
                        <div class="code-header">soia.yml</div>
                        <pre><code class="language-yaml">sourceDir: "./soia_src"
targetDir: "./soiagen"

generators:
  - mod: soia-typescript-gen
    config:
      importPathExtension: ""
  - mod: soia-python-gen
    config: {}
  - mod: soia-cc-gen
    config:
      writeGoogleTestHeaders: true</code></pre>
                    </div>
                </section>

                <!-- Quick Start -->
                <section id="quick-start" class="docs-section">
                    <h2>Quick Start</h2>
                    <p>Here's a simple example to get you started with Soia:</p>

                    <div class="step-by-step">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Create a Soia file</h4>
                                <div class="code-example">
                                    <div class="code-header">user.soia</div>
                                    <pre><code class="language-soia">struct User {
  id: int64;
  name: string;
  email: string;
  active: bool;
}

const DEFAULT_USER: User = {
  id = 0,
  name = "Anonymous",
  email = "",
  active = false,
};</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Generate code</h4>
                                <div class="code-example">
                                    <div class="code-header">Terminal</div>
                                    <pre><code class="language-bash">soiac</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Use the generated code</h4>
                                <div class="tab-container">
                                    <div class="tab-buttons">
                                        <button class="tab-btn active" data-tab="python-usage">Python</button>
                                        <button class="tab-btn" data-tab="typescript-usage">TypeScript</button>
                                        <button class="tab-btn" data-tab="cpp-usage">C++</button>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="python-usage">
                                            <div class="code-example">
                                                <pre><code class="language-python">from soiagen.user_soia import User

# Create a user
user = User.partial(
    id=123,
    name="John Doe",
    email="john@example.com",
    active=True
)

# Serialize to JSON
json_data = User.SERIALIZER.to_json_code(user)
print(json_data)  # [123,"John Doe","john@example.com",true]

# Deserialize from JSON
restored_user = User.SERIALIZER.from_json_code(json_data)
assert restored_user == user</code></pre>
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="typescript-usage">
                                            <div class="code-example">
                                                <pre><code class="language-typescript">import { User } from './soiagen/user';

// Create a user
const user = User.create({
  id: 123,
  name: "John Doe",
  email: "john@example.com",
  active: true
});

// Serialize to JSON
const jsonData = User.SERIALIZER.toJsonCode(user);
console.log(jsonData); // [123,"John Doe","john@example.com",true]

// Deserialize from JSON
const restoredUser = User.SERIALIZER.fromJsonCode(jsonData);
console.log(restoredUser.name); // "John Doe"</code></pre>
                                            </div>
                                        </div>
                                        <div class="tab-pane" id="cpp-usage">
                                            <div class="code-example">
                                                <pre><code class="language-cpp">#include "soiagen/user.h"

using ::soiagen_user::User;

// Create a user
User user = {
  .id = 123,
  .name = "John Doe",
  .email = "john@example.com",
  .active = true
};

// Serialize to JSON
std::string json = soia::ToDenseJson(user);
std::cout << json << std::endl; // [123,"John Doe","john@example.com",true]

// Deserialize from JSON
absl::StatusOr<User> restored_user = soia::Parse<User>(json);
assert(restored_user.ok() && *restored_user == user);</code></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Records -->
                <section id="records" class="docs-section">
                    <h2>Records</h2>
                    <p>There are two types of records in Soia: structs and enums.</p>

                    <h3>Structs</h3>
                    <p>Use the <code>struct</code> keyword to define a struct, which is a collection of fields of different types.</p>

                    <div class="code-example">
                        <div class="code-header">Basic Struct</div>
                        <pre><code class="language-soia">struct Point {
  x: int32;
  y: int32;
  label: string;
}</code></pre>
                    </div>

                    <h4>Field Numbers</h4>
                    <p>Fields can have explicit or implicit numbers. During serialization, fields are identified by numbers, not names:</p>

                    <div class="code-example">
                        <div class="code-header">Explicit Field Numbers</div>
                        <pre><code class="language-soia">struct Point {
  x: int = 0;
  y: int = 1;
  label: string = 2;
}</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">Implicit Field Numbers</div>
                        <pre><code class="language-soia">struct Point {
  x: int;      // implicitly 0
  y: int;      // implicitly 1
  label: string; // implicitly 2
}</code></pre>
                    </div>

                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> With implicit numbering, don't reorder fields or you won't be able to deserialize old values. Always use explicit numbering if you need to reorder fields.
                    </div>

                    <h4>Removing Fields</h4>
                    <p>When removing fields, mark the numbers as <code>removed</code>:</p>

                    <div class="code-example">
                        <div class="code-header">Removed Fields</div>
                        <pre><code class="language-soia">struct ExplicitNumbering {
  a: string = 0;
  b: string = 1;
  d: string = 3;
  removed 2, 4;
}

struct ImplicitNumbering {
  a: string;
  b: string;
  removed;      // field 2
  d: string;
  removed;      // field 4
}</code></pre>
                    </div>

                    <h3>Enums</h3>
                    <p>Enums in Soia are similar to Rust enums. Each variant can optionally have data associated with it:</p>

                    <div class="code-example">
                        <div class="code-header">Basic Enum</div>
                        <pre><code class="language-soia">enum OperationStatus {
  SUCCESS;           // constant field
  error: string;     // value field
}

// All enums have an implicit UNKNOWN variant</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">Complex Enum</div>
                        <pre><code class="language-soia">struct MoveAction {
  x: int32;
  y: int32;
}

enum BoardGameTurn {
  PASS;
  move: MoveAction;
  resign: string;   // resignation reason
}</code></pre>
                    </div>

                    <h4>Nested Records</h4>
                    <p>Records can be nested for better organization:</p>

                    <div class="code-example">
                        <div class="code-header">Nested Records</div>
                        <pre><code class="language-soia">enum Status {
  OK;

  struct Error {
    message: string;
    code: int32;
  }
  error: Error;
}

struct ApiResponse {
  status: Status;
  data: Status.Error?; // Use dot notation for nested types
}</code></pre>
                    </div>
                </section>

                <!-- Data Types -->
                <section id="data-types" class="docs-section">
                    <h2>Data Types</h2>

                    <h3>Primitive Types</h3>
                    <div class="type-grid">
                        <div class="type-item">
                            <code>bool</code>
                            <span>true or false</span>
                        </div>
                        <div class="type-item">
                            <code>int32</code>
                            <span>32-bit signed integer</span>
                        </div>
                        <div class="type-item">
                            <code>int64</code>
                            <span>64-bit signed integer</span>
                        </div>
                        <div class="type-item">
                            <code>uint64</code>
                            <span>64-bit unsigned integer</span>
                        </div>
                        <div class="type-item">
                            <code>float32</code>
                            <span>32-bit floating point</span>
                        </div>
                        <div class="type-item">
                            <code>float64</code>
                            <span>64-bit floating point</span>
                        </div>
                        <div class="type-item">
                            <code>string</code>
                            <span>Unicode string</span>
                        </div>
                        <div class="type-item">
                            <code>bytes</code>
                            <span>Sequence of bytes</span>
                        </div>
                        <div class="type-item">
                            <code>timestamp</code>
                            <span>Milliseconds since Unix epoch</span>
                        </div>
                    </div>

                    <h3>Array Types</h3>
                    <p>Arrays are denoted with square brackets:</p>

                    <div class="code-example">
                        <div class="code-header">Array Types</div>
                        <pre><code class="language-soia">struct Examples {
  numbers: [int32];
  names: [string];
  points: [Point];
}</code></pre>
                    </div>

                    <h4>Keyed Arrays</h4>
                    <p>For arrays of structs, you can specify a key field for fast lookups:</p>

                    <div class="code-example">
                        <div class="code-header">Keyed Arrays</div>
                        <pre><code class="language-soia">struct User {
  id: uint64;
  name: string;
}

struct UserRegistry {
  users: [User|id];  // Key by 'id' field
}

// Nested keys are supported
struct Employee {
  profile: UserProfile;
  // ...
}

struct Company {
  employees: [Employee|profile.user.id];
}</code></pre>
                    </div>

                    <h3>Optional Types</h3>
                    <p>Add <code>?</code> to make a type optional:</p>

                    <div class="code-example">
                        <div class="code-header">Optional Types</div>
                        <pre><code class="language-soia">struct User {
  id: int64;
  name: string;
  email: string?;        // optional
  profile_picture: bytes?;
}</code></pre>
                    </div>
                </section>

                <!-- Constants -->
                <section id="constants" class="docs-section">
                    <h2>Constants</h2>
                    <p>Define constants of any Soia type using JSON-like syntax with enhancements:</p>

                    <div class="code-example">
                        <div class="code-header">Basic Constants</div>
                        <pre><code class="language-soia">const PI: float64 = 3.14159;
const MAX_USERS: int32 = 1000;
const DEFAULT_NAME: string = "Anonymous";</code></pre>
                    </div>

                    <h3>Object Constants</h3>

                    <div class="code-example">
                        <div class="code-header">Struct Constants</div>
                        <pre><code class="language-soia">const ORIGIN: Point = {
  x = 0,
  y = 0,
  label = "origin",
};

const LARGE_CIRCLE: Circle = {
  center: {
    x: 100,
    y: 100,
  },
  radius: 100,
  color: {
    r: 255,
    g: 0,
    b: 255,
    label: "fuschia",
  },
};</code></pre>
                    </div>

                    <h3>Array Constants</h3>

                    <div class="code-example">
                        <div class="code-header">Array Constants</div>
                        <pre><code class="language-soia">const SUPPORTED_LOCALES: [string] = [
  "en-GB",
  "en-US",
  "es-MX",
];</code></pre>
                    </div>

                    <h3>Enum Constants</h3>

                    <div class="code-example">
                        <div class="code-header">Enum Constants</div>
                        <pre><code class="language-soia">// Constant variants use strings
const REST_DAY: Weekday = "SUNDAY";

// Value variants use objects
const ERROR_STATUS: OperationStatus = {
  kind: "error",
  value: "Not implemented",
};</code></pre>
                    </div>

                    <h3>Multiline Strings</h3>

                    <div class="code-example">
                        <div class="code-header">Multiline Strings</div>
                        <pre><code class="language-soia">const HELP_TEXT: string = 'Usage: myapp [options]\
\
Options:\
  -h, --help     Show this help message\
  -v, --version  Show version\
';</code></pre>
                    </div>
                </section>

                <!-- Methods -->
                <section id="methods" class="docs-section">
                    <h2>Methods</h2>
                    <p>Define RPC method signatures using the <code>method</code> keyword:</p>

                    <div class="code-example">
                        <div class="code-header">Method Definition</div>
                        <pre><code class="language-soia">struct GetUserRequest {
  user_id: int64;
}

struct GetUserResponse {
  user: User?;
  error: string?;
}

// Method signature
method GetUser(GetUserRequest): GetUserResponse;

// Methods can use any Soia type
method Echo(string): string;
method Add(int32, int32): int32;
method IsPalindrome(string): bool;</code></pre>
                    </div>
                </section>

                <!-- Imports -->
                <section id="imports" class="docs-section">
                    <h2>Imports</h2>
                    <p>Import types from other Soia modules:</p>

                    <div class="code-example">
                        <div class="code-header">Import Statements</div>
                        <pre><code class="language-soia">// Import specific types
import Point, Circle from "geometry/geometry.soia";

// Import entire module with alias
import * as color from "color.soia";

struct Rectangle {
  top_left: Point;
  bottom_right: Point;
}

struct Disk {
  circle: Circle;
  fill_color: color.Color;  // qualified name
}</code></pre>
                    </div>

                    <p>Import paths are always relative to the root of the Soia source directory.</p>
                </section>

                <!-- Serialization Formats -->
                <section id="json-dense" class="docs-section">
                    <h2>Serialization Formats</h2>
                    <p>Soia supports three serialization formats:</p>

                    <h3>JSON (Dense Flavor)</h3>
                    <p>The recommended format for most use cases. Structs are serialized as arrays where field numbers match array indices:</p>

                    <div class="code-example">
                        <div class="code-header">Dense JSON Example</div>
                        <pre><code class="language-soia">struct User {
  user_id: int;
  removed;
  name: string;
  active: bool;
  nickname: string;
}

const JOHN: User = {
  user_id = 400,
  name = "John Doe",
  active = true,
  nickname = "",
};</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">Dense JSON Output</div>
                        <pre><code class="language-json">[400, 0, "John Doe", true]</code></pre>
                    </div>

                    <div class="info-box">
                        <strong>üìù Note:</strong> Removed fields become zeros, and trailing fields with default values are omitted. This format allows field renaming without breaking compatibility.
                    </div>
                </section>

                <section id="json-readable" class="docs-section">
                    <h3>JSON (Readable Flavor)</h3>
                    <p>More human-readable format using field names. Use for debugging only:</p>

                    <div class="code-example">
                        <div class="code-header">Readable JSON Output</div>
                        <pre><code class="language-json">{
  "user_id": 400,
  "name": "John Doe",
  "active": true
}</code></pre>
                    </div>

                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Warning:</strong> Don't use readable JSON for persistence as field renaming will break deserialization.
                    </div>
                </section>

                <section id="binary-format" class="docs-section">
                    <h3>Binary Format</h3>
                    <p>More compact than JSON with potentially faster serialization. Use only when performance gains matter:</p>

                    <div class="code-example">
                        <div class="code-header">Binary Format Usage</div>
                        <pre><code class="language-python"># Python
binary_data = User.SERIALIZER.to_bytes(user)
restored_user = User.SERIALIZER.from_bytes(binary_data)</code></pre>
                    </div>
                </section>

                <!-- Code Generators -->
                <section id="typescript-generator" class="docs-section">
                    <h2>TypeScript Generator</h2>
                    <p>Generate TypeScript/JavaScript code for Node.js, Deno, or browser environments.</p>

                    <h3>Installation</h3>
                    <div class="code-example">
                        <div class="code-header">Terminal</div>
                        <pre><code class="language-bash">npm install --save-dev soia-typescript-gen</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">soia.yml</div>
                        <pre><code class="language-yaml">generators:
  - mod: soia-typescript-gen
    config:
      # "" (CommonJS), ".js" (ES Modules), ".ts" (Deno)
      importPathExtension: ""</code></pre>
                    </div>

                    <h3>Generated Code</h3>
                    <p>Soia generates both frozen (immutable) and mutable versions of each struct:</p>

                    <h4>Frozen Structs</h4>
                    <div class="code-example">
                        <div class="code-header">TypeScript Usage</div>
                        <pre><code class="language-typescript">import { User } from "../soiagen/user";

// Create frozen/immutable instances
const john = User.create({
  userId: 42,
  name: "John Doe",
});

// Force initialization of all fields
const jane = User.create<"whole">({
  userId: 43,
  name: "Jane Doe",
  quote: "Hello world",
  pets: [{ name: "Fluffy" }],
  subscriptionStatus: "PREMIUM",
});

const defaultUser = User.DEFAULT;</code></pre>
                    </div>

                    <h4>Mutable Structs</h4>
                    <div class="code-example">
                        <div class="code-header">Mutable TypeScript Usage</div>
                        <pre><code class="language-typescript">// Create mutable instances
const lylaMut = new User.Mutable();
lylaMut.userId = 44;
lylaMut.name = "Lyla Doe";

// With initializer
const jolyMut = new User.Mutable({ userId: 45 });
jolyMut.name = "Joly Doe";

// Access mutable nested objects
lylaMut.mutablePets.push(User.Pet.create({ name: "Cupcake" }));</code></pre>
                    </div>

                    <h4>Converting Between Frozen and Mutable</h4>
                    <div class="code-example">
                        <div class="code-header">Conversion</div>
                        <pre><code class="language-typescript">// toMutable() does shallow copy
const evilJaneMut = jane.toMutable();
evilJaneMut.name = "Evil Jane";

// toFrozen() recursively freezes
const evilJane: User = evilJaneMut.toFrozen();</code></pre>
                    </div>

                    <h4>Enums</h4>
                    <div class="code-example">
                        <div class="code-header">TypeScript Enums</div>
                        <pre><code class="language-typescript">// Constant variants
const johnStatus = User.SubscriptionStatus.FREE;
const janeStatus = User.SubscriptionStatus.PREMIUM;

// Data variants
const roniStatus = User.SubscriptionStatus.create({
  kind: "trial",
  value: {
    startTime: Timestamp.fromUnixMillis(1234),
  },
});

// Type-safe switching
function getInfo(status: User.SubscriptionStatus): string {
  switch (status.union.kind) {
    case "?":
      return "Unknown";
    case "FREE":
      return "Free user";
    case "PREMIUM":
      return "Premium user";
    case "trial":
      return "On trial since " + status.union.value.startTime;
  }
}</code></pre>
                    </div>

                    <h4>Serialization</h4>
                    <div class="code-example">
                        <div class="code-header">TypeScript Serialization</div>
                        <pre><code class="language-typescript">const serializer = User.SERIALIZER;

// Dense JSON (recommended)
const denseJson = serializer.toJsonCode(john);
console.log(denseJson); // [42,"John Doe"]

// Readable JSON (debugging)
const readableJson = serializer.toJsonCode(john, "readable");

// Binary format
const bytes = serializer.toBytes(john);

// Deserialization
const restoredUser = serializer.fromJsonCode(denseJson);</code></pre>
                    </div>

                    <h4>Keyed Arrays</h4>
                    <div class="code-example">
                        <div class="code-header">TypeScript Keyed Arrays</div>
                        <pre><code class="language-typescript">const userRegistry = UserRegistry.create({
  users: [john, jane, lylaMut],
});

// O(1) lookup by key
const foundUser = userRegistry.searchUsers(42); // returns john
const notFound = userRegistry.searchUsers(100); // returns undefined</code></pre>
                    </div>
                </section>

                <section id="python-generator" class="docs-section">
                    <h2>Python Generator</h2>
                    <p>Generate Python code targeting Python 3.10 and higher.</p>

                    <h3>Installation</h3>
                    <div class="code-example">
                        <div class="code-header">Terminal</div>
                        <pre><code class="language-bash">npm install --save-dev soia-python-gen</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">soia.yml</div>
                        <pre><code class="language-yaml">generators:
  - mod: soia-python-gen
    config: {}</code></pre>
                    </div>

                    <h3>Generated Code</h3>

                    <h4>Frozen Structs</h4>
                    <div class="code-example">
                        <div class="code-header">Python Usage</div>
                        <pre><code class="language-python">from soiagen.user_soia import User

# Create with partial initialization
john = User.partial(
    user_id=42,
    name="John Doe",
)

# Unspecified fields get default values
assert john.email == ""

# Full initialization (all fields required)
jane = User(
    user_id=43,
    name="Jane Doe",
    email="jane@example.com",
    active=True,
)</code></pre>
                    </div>

                    <h4>Mutable Structs</h4>
                    <div class="code-example">
                        <div class="code-header">Python Mutable Usage</div>
                        <pre><code class="language-python"># Create mutable instances
lyla_mut = User.Mutable()
lyla_mut.user_id = 44
lyla_mut.name = "Lyla Doe"

# With constructor arguments
joly_mut = User.Mutable(user_id=45)
joly_mut.name = "Joly Doe"

# Access mutable nested objects
lyla_mut.mutable_pets.append(User.Pet.partial(name="Cupcake"))</code></pre>
                    </div>

                    <h4>Converting Between Frozen and Mutable</h4>
                    <div class="code-example">
                        <div class="code-header">Python Conversion</div>
                        <pre><code class="language-python"># to_mutable() does shallow copy
evil_jane_mut = jane.to_mutable()
evil_jane_mut.name = "Evil Jane"

# to_frozen() recursively freezes
evil_jane: User = evil_jane_mut.to_frozen()

# Or use replace() on frozen structs
evil_jane = jane.replace(name="Evil Jane")</code></pre>
                    </div>

                    <h4>Enums</h4>
                    <div class="code-example">
                        <div class="code-header">Python Enums</div>
                        <pre><code class="language-python"># Constant variants
john_status = User.SubscriptionStatus.FREE
jane_status = User.SubscriptionStatus.PREMIUM

# Data variants
roni_status = User.SubscriptionStatus.wrap_trial(
    User.Trial(start_time=soia.Timestamp.from_unix_millis(1744974198000))
)

# Type-safe pattern matching
def get_info(status: User.SubscriptionStatus) -> str:
    if status.union.kind == "?":
        return "Unknown"
    elif status.union.kind == "FREE":
        return "Free user"
    elif status.union.kind == "trial":
        trial: User.Trial = status.union.value
        return f"On trial since {trial.start_time}"
    elif status.union.kind == "PREMIUM":
        return "Premium user"
    
    # Static type checker will catch missing cases
    _: Never = status.union.kind
    raise AssertionError("Unreachable")</code></pre>
                    </div>

                    <h4>Serialization</h4>
                    <div class="code-example">
                        <div class="code-header">Python Serialization</div>
                        <pre><code class="language-python">serializer = User.SERIALIZER

# Dense JSON (recommended)
json_list = serializer.to_json(john)  # returns list
json_str = serializer.to_json_code(john)  # returns string

# Readable JSON (debugging)
readable = serializer.to_json_code(john, readable=True)

# Deserialization
restored = serializer.from_json_code(json_str)</code></pre>
                    </div>

                    <h4>Keyed Arrays</h4>
                    <div class="code-example">
                        <div class="code-header">Python Keyed Arrays</div>
                        <pre><code class="language-python">user_registry = UserRegistry(users=[john, jane, lyla_mut])

# O(1) lookup methods
found_user = user_registry.users.find(42)  # returns john or None
default_user = user_registry.users.find_or_default(100)  # returns default User</code></pre>
                    </div>
                </section>

                <section id="cpp-generator" class="docs-section">
                    <h2>C++ Generator</h2>
                    <p>Generate C++17 compatible code with support for Abseil and GoogleTest.</p>

                    <h3>Installation</h3>
                    <div class="code-example">
                        <div class="code-header">Terminal</div>
                        <pre><code class="language-bash">npm install --save-dev soia-cc-gen</code></pre>
                    </div>

                    <div class="code-example">
                        <div class="code-header">soia.yml</div>
                        <pre><code class="language-yaml">generators:
  - mod: soia-cc-gen
    config:
      writeGoogleTestHeaders: true</code></pre>
                    </div>

                    <h3>Generated Code</h3>

                    <h4>Structs</h4>
                    <div class="code-example">
                        <div class="code-header">C++ Usage</div>
                        <pre><code class="language-cpp">#include "soiagen/user.h"

using ::soiagen_user::User;

// Basic construction
User john;
john.user_id = 42;
john.name = "John Doe";

// Designated initializer syntax
User jane = {
    .name = "Jane Doe",
    .user_id = 43,
    .active = true,
};

// Force all fields initialization
User lyla = User::whole{
    .name = "Lyla Doe",
    .user_id = 44,
    .active = true,
    .email = "lyla@example.com",
};</code></pre>
                    </div>

                    <h4>Enums</h4>
                    <div class="code-example">
                        <div class="code-header">C++ Enums</div>
                        <pre><code class="language-cpp">// Constant variants
User::SubscriptionStatus john_status = soiagen::kFree;
User::SubscriptionStatus jane_status = soiagen::kPremium;

// Data variants
User::SubscriptionStatus jade_status =
    soiagen::wrap_trial_start_time(absl::FromUnixMillis(1743682787000));

// Pattern matching with switch
switch (status.kind()) {
  case User::SubscriptionStatus::kind_type::kConstFree:
    // Handle free user
    break;
  case User::SubscriptionStatus::kind_type::kValTrialStartTime: {
    const absl::Time& start_time = status.as_trial_start_time();
    // Handle trial user
    break;
  }
}

// Visitor pattern
struct StatusVisitor {
  void operator()(soiagen::k_free) const {
    std::cout << "Free user\n";
  }
  void operator()(User::SubscriptionStatus::wrap_trial_start_time_type& w) const {
    std::cout << "Trial started: " << w.value << "\n";
  }
};
status.visit(StatusVisitor());</code></pre>
                    </div>

                    <h4>Serialization</h4>
                    <div class="code-example">
                        <div class="code-header">C++ Serialization</div>
                        <pre><code class="language-cpp">// Dense JSON (recommended)
std::string dense_json = soia::ToDenseJson(john);
std::cout << dense_json << "\n"; // [42,"John Doe",true,"john@example.com"]

// Readable JSON (debugging)
std::string readable_json = soia::ToReadableJson(john);

// Binary format
soia::Bytes binary_data = soia::ToBytes(john);

// Deserialization
absl::StatusOr<User> maybe_user = soia::Parse<User>(dense_json);
if (maybe_user.ok()) {
    User restored_user = *maybe_user;
}</code></pre>
                    </div>

                    <h4>Keyed Arrays</h4>
                    <div class="code-example">
                        <div class="code-header">C++ Keyed Arrays</div>
                        <pre><code class="language-cpp">UserRegistry user_registry;
soia::keyed_items<User, soiagen::get_user_id<>>& users = user_registry.users;

users.push_back(john);
users.push_back(jane);

// O(1) lookup
const User* maybe_jane = users.find_or_null(43);
assert(maybe_jane != nullptr && *maybe_jane == jane);

// With default fallback
User default_user = users.find_or_default(999);
assert(default_user.name == ""); // default values</code></pre>
                    </div>

                    <h4>Testing with GoogleTest</h4>
                    <div class="code-example">
                        <div class="code-header">C++ Testing</div>
                        <pre><code class="language-cpp">#include "soiagen/user.test.h"

// Struct matchers
EXPECT_THAT(john, (StructIs<User>{
    .name = "John Doe",
    .user_id = 42,
    .active = true,
}));

// Partial matching
EXPECT_THAT(jane, (StructIs<User>{
    .name = testing::StartsWith("Jane"),
    .user_id = testing::Gt(40),
    // Other fields not specified
}));

// Enum matchers
EXPECT_THAT(john_status, testing::Eq(soiagen::kFree));
EXPECT_THAT(jade_status, IsTrialStartTime(testing::Gt(absl::UnixEpoch())));</code></pre>
                    </div>
                </section>

                <!-- Services -->
                <section id="soia-services" class="docs-section">
                    <h2>Soia Services</h2>
                    <p>Soia provides built-in support for building type-safe RPC services.</p>

                    <h3>Service Definition</h3>
                    <div class="code-example">
                        <div class="code-header">user_service.soia</div>
                        <pre><code class="language-soia">struct GetUserRequest {
  user_id: int64;
}

struct GetUserResponse {
  user: User?;
  error: string?;
}

struct CreateUserRequest {
  name: string;
  email: string;
}

struct CreateUserResponse {
  user: User;
  error: string?;
}

// RPC method definitions
method GetUser(GetUserRequest): GetUserResponse;
method CreateUser(CreateUserRequest): CreateUserResponse;
method ListUsers(): [User];</code></pre>
                    </div>

                    <h3>HTTP API</h3>
                    <p>Services automatically provide HTTP endpoints. Call methods with cURL:</p>

                    <div class="code-example">
                        <div class="code-header">cURL Example</div>
                        <pre><code class="language-bash">curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "method": "GetUser",
    "request": {"user_id": 123}
  }' \
  http://localhost:8787/api</code></pre>
                    </div>
                </section>

                <section id="service-examples" class="docs-section">
                    <h3>Service Implementation Examples</h3>

                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="typescript-service">TypeScript</button>
                            <button class="tab-btn" data-tab="python-service">Python</button>
                            <button class="tab-btn" data-tab="cpp-service">C++</button>
                        </div>
                        <div class="tab-content">
                            <div class="tab-pane active" id="typescript-service">
                                <h4>TypeScript Server</h4>
                                <div class="code-example">
                                    <pre><code class="language-typescript">import express from 'express';
import { SoiaService } from 'soia-typescript-gen/service';
import { GetUserRequest, GetUserResponse, User } from './soiagen/user_service';

const app = express();
app.use(express.json());

const service = new SoiaService();

service.addMethod('GetUser', async (req: GetUserRequest): Promise<GetUserResponse> => {
  // Your business logic here
  const user = await findUserById(req.userId);
  
  if (user) {
    return GetUserResponse.create({ user });
  } else {
    return GetUserResponse.create({ 
      error: "User not found" 
    });
  }
});

app.post('/api', service.createHandler());
app.listen(8787);</code></pre>
                                </div>
                                
                                <h4>TypeScript Client</h4>
                                <div class="code-example">
                                    <pre><code class="language-typescript">import { SoiaClient } from 'soia-typescript-gen/client';
import { GetUserRequest, GetUserResponse } from './soiagen/user_service';

const client = new SoiaClient('http://localhost:8787/api');

const response = await client.call<GetUserResponse>(
  'GetUser',
  GetUserRequest.create({ userId: 123 })
);

if (response.user) {
  console.log(`Found user: ${response.user.name}`);
} else {
  console.error(`Error: ${response.error}`);
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="tab-pane" id="python-service">
                                <h4>Python Server</h4>
                                <div class="code-example">
                                    <pre><code class="language-python">from flask import Flask, request, jsonify
from soiagen.user_service_soia import GetUserRequest, GetUserResponse, User

app = Flask(__name__)

@app.route('/api', methods=['POST'])
def handle_request():
    data = request.get_json()
    method = data['method']
    request_data = data['request']
    
    if method == 'GetUser':
        req = GetUserRequest.SERIALIZER.from_json(request_data)
        user = find_user_by_id(req.user_id)
        
        if user:
            response = GetUserResponse.partial(user=user)
        else:
            response = GetUserResponse.partial(error="User not found")
        
        return jsonify(GetUserResponse.SERIALIZER.to_json(response))
    
    return jsonify({"error": "Unknown method"}), 400

if __name__ == '__main__':
    app.run(port=8787)</code></pre>
                                </div>
                                
                                <h4>Python Client</h4>
                                <div class="code-example">
                                    <pre><code class="language-python">import requests
from soiagen.user_service_soia import GetUserRequest, GetUserResponse

def call_service(method: str, request_data):
    response = requests.post('http://localhost:8787/api', json={
        'method': method,
        'request': request_data
    })
    return response.json()

# Make a call
request = GetUserRequest.partial(user_id=123)
request_json = GetUserRequest.SERIALIZER.to_json(request)

response_json = call_service('GetUser', request_json)
response = GetUserResponse.SERIALIZER.from_json(response_json)

if response.user:
    print(f"Found user: {response.user.name}")
else:
    print(f"Error: {response.error}")</code></pre>
                                </div>
                            </div>
                            
                            <div class="tab-pane" id="cpp-service">
                                <h4>C++ Server</h4>
                                <div class="code-example">
                                    <pre><code class="language-cpp">#include "soiagen/user_service.h"
#include "soia/service.h"

using ::soiagen_user_service::GetUserRequest;
using ::soiagen_user_service::GetUserResponse;

class UserServiceImpl : public soia::Service {
public:
  void RegisterMethods() override {
    RegisterMethod<GetUserRequest, GetUserResponse>(
        "GetUser", [this](const GetUserRequest& request) {
          return this->GetUser(request);
        });
  }

private:
  GetUserResponse GetUser(const GetUserRequest& request) {
    // Your business logic here
    auto maybe_user = FindUserById(request.user_id);
    
    if (maybe_user.has_value()) {
      return {.user = *maybe_user};
    } else {
      return {.error = "User not found"};
    }
  }
};

int main() {
  UserServiceImpl service;
  service.RegisterMethods();
  service.StartHttpServer(8787);
  return 0;
}</code></pre>
                                </div>
                                
                                <h4>C++ Client</h4>
                                <div class="code-example">
                                    <pre><code class="language-cpp">#include "soiagen/user_service.h"
#include "soia/client.h"

using ::soiagen_user_service::GetUserRequest;
using ::soiagen_user_service::GetUserResponse;

int main() {
  soia::Client client("http://localhost:8787/api");
  
  GetUserRequest request = {.user_id = 123};
  
  absl::StatusOr<GetUserResponse> maybe_response = 
      client.Call<GetUserResponse>("GetUser", request);
  
  if (!maybe_response.ok()) {
    std::cerr << "RPC failed: " << maybe_response.status() << "\n";
    return 1;
  }
  
  const GetUserResponse& response = *maybe_response;
  if (response.user.has_value()) {
    std::cout << "Found user: " << response.user->name << "\n";
  } else {
    std::cout << "Error: " << response.error << "\n";
  }
  
  return 0;
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="nav-brand">
                        <img src="../assets/logo.svg" alt="Soia Logo" class="logo" width="24" height="24">
                        <span class="brand-text">Soia</span>
                    </div>
                    <p class="footer-description">
                        Like Protocol Buffer, but better. Generate type-safe code in multiple languages.
                    </p>
                </div>
                <div class="footer-links">
                    <div class="link-group">
                        <h4>Documentation</h4>
                        <a href="#introduction">Introduction</a>
                        <a href="#quick-start">Quick Start</a>
                        <a href="#records">Language Reference</a>
                    </div>
                    <div class="link-group">
                        <h4>Generators</h4>
                        <a href="#typescript-generator">TypeScript</a>
                        <a href="#python-generator">Python</a>
                        <a href="#cpp-generator">C++</a>
                    </div>
                    <div class="link-group">
                        <h4>Community</h4>
                        <a href="https://github.com/gepheum/soia" target="_blank">GitHub</a>
                        <a href="https://github.com/gepheum/soia/issues" target="_blank">Issues</a>
                        <a href="https://github.com/gepheum/soia/discussions" target="_blank">Discussions</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Soia. Open source under the MIT License.</p>
            </div>
        </div>
    </footer>

    <script src="../scripts/main.js"></script>
    <script src="../scripts/docs.js"></script>
</body>
</html>
